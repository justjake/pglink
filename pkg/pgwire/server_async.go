// Code generated by generate.go; DO NOT EDIT.

package pgwire

import (
	"fmt"

	"github.com/jackc/pgx/v5/pgproto3"
)

// ServerAsync is implemented by all Server Async message wrapper types.
type ServerAsync interface {
	Async()
	PgwireMessage() pgproto3.Message
	Server() pgproto3.BackendMessage
	Raw() RawBody
}

// Compile-time checks that all wrapper types implement the interface.
var (
	_ ServerAsync = ServerAsyncNoticeResponse{}
	_ ServerAsync = ServerAsyncNotificationResponse{}
	_ ServerAsync = ServerAsyncParameterStatus{}
)

// Warning message.
type ServerAsyncNoticeResponse struct {
	LazyServer[*pgproto3.NoticeResponse]
}

func (ServerAsyncNoticeResponse) Async()                            {}
func (t ServerAsyncNoticeResponse) PgwireMessage() pgproto3.Message { return t.Parse() }
func (t ServerAsyncNoticeResponse) Server() pgproto3.BackendMessage { return t.Parse() }

// LISTEN/NOTIFY notification.
type ServerAsyncNotificationResponse struct {
	LazyServer[*pgproto3.NotificationResponse]
}

func (ServerAsyncNotificationResponse) Async()                            {}
func (t ServerAsyncNotificationResponse) PgwireMessage() pgproto3.Message { return t.Parse() }
func (t ServerAsyncNotificationResponse) Server() pgproto3.BackendMessage { return t.Parse() }

// Informs client that runtime parameter value changed.
type ServerAsyncParameterStatus struct {
	LazyServer[*pgproto3.ParameterStatus]
}

func (ServerAsyncParameterStatus) Async()                            {}
func (t ServerAsyncParameterStatus) PgwireMessage() pgproto3.Message { return t.Parse() }
func (t ServerAsyncParameterStatus) Server() pgproto3.BackendMessage { return t.Parse() }

// ToServerAsync converts a pgproto3.BackendMessage to a ServerAsync if it matches one of the known types.
func ToServerAsync(msg pgproto3.BackendMessage) (ServerAsync, bool) {
	switch m := msg.(type) {
	case *pgproto3.NoticeResponse:
		return ServerAsyncNoticeResponse{NewLazyServerFromParsed(m)}, true
	case *pgproto3.NotificationResponse:
		return ServerAsyncNotificationResponse{NewLazyServerFromParsed(m)}, true
	case *pgproto3.ParameterStatus:
		return ServerAsyncParameterStatus{NewLazyServerFromParsed(m)}, true
	}
	return nil, false
}

// ServerAsyncHandlers provides type-safe handlers for each ServerAsync variant.
type ServerAsyncHandlers[T any] struct {
	NoticeResponse       func(msg ServerAsyncNoticeResponse) (T, error)
	NotificationResponse func(msg ServerAsyncNotificationResponse) (T, error)
	ParameterStatus      func(msg ServerAsyncParameterStatus) (T, error)
}

// HandleDefault dispatches to the appropriate handler, or calls defaultHandler if the handler is nil.
func (h ServerAsyncHandlers[T]) HandleDefault(msg ServerAsync, defaultHandler func(msg ServerAsync) (T, error)) (r T, err error) {
	switch msg := msg.(type) {
	case ServerAsyncNoticeResponse:
		if h.NoticeResponse != nil {
			return h.NoticeResponse(msg)
		} else {
			return defaultHandler(msg)
		}
	case ServerAsyncNotificationResponse:
		if h.NotificationResponse != nil {
			return h.NotificationResponse(msg)
		} else {
			return defaultHandler(msg)
		}
	case ServerAsyncParameterStatus:
		if h.ParameterStatus != nil {
			return h.ParameterStatus(msg)
		} else {
			return defaultHandler(msg)
		}
	}
	err = fmt.Errorf("unknown server async message: %T", msg)
	return
}

// Handle dispatches to the appropriate handler, or panics if the handler is nil.
func (h ServerAsyncHandlers[T]) Handle(msg ServerAsync) (T, error) {
	return h.HandleDefault(msg, func(msg ServerAsync) (T, error) {
		panic(fmt.Sprintf("no handler defined for server async message: %T", msg))
	})
}
