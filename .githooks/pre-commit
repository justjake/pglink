#!/usr/bin/env bash
set -euo pipefail

cd "$(dirname "$0")/.."
eval "$(mise activate bash --shims)"

# Check if formatting is needed
unformatted=$(find . -name '*.go' -not -path './vendor/*' | xargs gofmt -l)
if [[ -n "$unformatted" ]]; then
    echo "These files need formatting:"
    echo "$unformatted"
    echo ""
    echo "Run 'bin/format' to fix."
    exit 1
fi

# Run lint
echo "Running lint..."
bin/lint
